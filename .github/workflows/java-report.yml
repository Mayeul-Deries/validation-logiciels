name: Java Report for BankApplication

on:
  push:
  pull_request:

jobs:
  java-report:
    runs-on: ubuntu-latest

    steps:
      - name: Récupération du dépôt
        uses: actions/checkout@v4

      - name: Analyse des fichiers Java et génération du rapport
        run: |
          JAVA_FILES=$(find . -name "*.java")

          # Échec si aucun fichier Java
          if [ -z "$JAVA_FILES" ]; then
            echo "Erreur : aucun fichier .java trouvé dans le dépôt"
            exit 1
          fi

          # Échec si des fichiers .class sont présents
          if find . -name "*.class" | grep -q .; then
            echo "Erreur : des fichiers compilés (.class) sont présents dans le dépôt"
            exit 1
          fi

          echo "Java File Report" > java-file-report.txt
          echo "================" >> java-file-report.txt
          echo "" >> java-file-report.txt

          FILE_COUNT=$(echo "$JAVA_FILES" | wc -l)
          TOTAL_LINES=0

          echo "Nombre de fichiers .java : $FILE_COUNT" >> java-file-report.txt
          echo "" >> java-file-report.txt
          echo "Détail par fichier (chemin - nombre de lignes) :" >> java-file-report.txt

          for file in $JAVA_FILES; do
            LINES=$(wc -l < "$file")
            TOTAL_LINES=$((TOTAL_LINES + LINES))
            echo "$file - $LINES" >> java-file-report.txt
          done

          echo "" >> java-file-report.txt
          echo "Nombre total de lignes de code : $TOTAL_LINES" >> java-file-report.txt

      - name: Upload du rapport en tant qu'artifact
        uses: actions/upload-artifact@v4
        with:
          name: java-file-report
          path: java-file-report.txt
